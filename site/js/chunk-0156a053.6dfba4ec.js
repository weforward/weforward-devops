(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0156a053"],{"9be4":function(t,s,e){"use strict";e("a987")},a1af:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("WoolShowmodal",{attrs:{isshow:t.isshow,isshowcloser:!0},on:{tapCloser:t.closeShowModel}},[e("div",{staticClass:"showbox",style:{width:t.boxwidth,height:t.boxheight}},[e("div",{staticClass:"tab_title"},[e("div",{class:["tab_item",t.isJs?"choosed":""],on:{click:function(s){return t.changeTab("js")}}},[e("span",[t._v("Jstack")])]),e("div",{class:["tab_item",t.isJs?"":"choosed"],on:{click:function(s){return t.changeTab("jm")}}},[e("span",[t._v("Jmap")])])]),e("div",{staticClass:"tab_content"},[t.isJs?e("div",[e("div",{staticClass:"table wt-scroll"},[e("div",{staticClass:"query_button",on:{click:function(s){return t.printstack()}}},[t._v("Thread Dump")]),e("table",{},[e("tr",{staticClass:"table_head"},[e("td",{staticStyle:{width:"30%"}},[t._v("文件名")]),e("td",{staticStyle:{width:"20%"}},[t._v("大小")]),e("td",{staticStyle:{width:"30%"}},[t._v("日期")]),e("td",{staticStyle:{width:"20%"}},[t._v("操作")])]),t._l(t.stackList,(function(s,a){return e("tr",{key:a,staticClass:"table_content"},[e("td",[t._v(t._s(s.name))]),e("td",[t._v(t._s(s.length))]),e("td",[t._v(t._s(s.create_time))]),e("td",[e("span",{on:{click:function(e){return t.checkstack(s.name)}}},[t._v("查看")]),t._v(" "),e("span",{on:{click:function(e){return t.download(s.name)}}},[t._v("下载")])])])}))],2)]),e("PagerBar",{staticStyle:{"margin-right":"55%","margin-bottom":"2%"},attrs:{page:t.page},on:{change:t.searchByPage}}),e("div",{staticClass:"look_detail"},[e("div",{staticClass:"tasktitle"},[e("span",{staticStyle:{color:"red"}},[t._v("●")]),e("span",{staticStyle:{color:"#FFC000"}},[t._v("●")]),e("span",{staticStyle:{color:"#2E75B6"}},[t._v("●")]),t._v(" \n            文件名："+t._s(t.filename)+"\n          ")]),e("div",{staticClass:"taskcontent wt-scroll",domProps:{innerHTML:t._s(t.replace(t.stacks))}})])],1):e("div",[e("div",{staticClass:"table",staticStyle:{margin:"0 auto",width:"90%"}},[e("div",{staticClass:"query_button",on:{click:function(s){return t.printmap()}}},[t._v("Heap Dump")]),e("table",{staticClass:"wt-scroll",staticStyle:{margin:"0 auto"}},[e("tr",{staticClass:"table_head"},[e("td",{staticStyle:{width:"30%"}},[t._v("文件名")]),e("td",{staticStyle:{width:"20%"}},[t._v("大小")]),e("td",{staticStyle:{width:"40%"}},[t._v("日期")]),e("td",{staticStyle:{width:"30%"}},[t._v("操作")])]),t._l(t.mapList,(function(s,a){return e("tr",{key:a,staticClass:"table_content"},[e("td",[t._v(t._s(s.name))]),e("td",[t._v(t._s(s.length))]),e("td",[t._v(t._s(s.create_time))]),e("td",[e("span",{on:{click:function(e){return t.downloadMap(s.name)}}},[t._v("下载")])])])}))],2),e("PagerBar",{staticStyle:{"margin-bottom":"2%"},attrs:{page:t.pagemap},on:{change:t.searchByPage}})],1)])])]),e("WoolShowmodal",{attrs:{isshow:t.showTask,isshowcloser:!0},on:{tapCloser:t.closeShowTask}},[e("div",{staticClass:"task"},[e("div",{staticClass:"tasktitle"},[e("span",{staticStyle:{color:"red"}},[t._v("●")]),e("span",{staticStyle:{color:"#FFC000"}},[t._v("●")]),e("span",{staticStyle:{color:"#2E75B6"}},[t._v("●")]),t._v(" 当前状态："+t._s(t.currentStatus||"--"))]),e("div",{staticClass:"cmdscreen wt-scroll"},[e("ul",{ref:"taskList",staticClass:"task-list"},t._l(t.statusList,(function(s,a){return e("li",{key:a},[t._v(t._s(s.desc||"--"))])})),0)])])])],1)},o=[],i=(e("a481"),e("c5f6"),{components:{WoolShowmodal:function(){return e.e("chunk-41c82f40").then(e.bind(null,"59c5"))},PagerBar:function(){return e.e("chunk-22e86add").then(e.bind(null,"2f3e"))}},props:{isshow:{type:Boolean,default:!1},id:{type:String,default:""},index:{type:Number,default:-1},state:{type:Number,default:-1}},watch:{isshow:function(t){this.isJs=!0,1==t&&this.getStack()}},data:function(){return{boxwidth:"96vw",boxheight:"96vh",isJs:!0,stackList:[],page:{current:1,pagecount:1,totalCount:0,pagesize:10},pagemap:{current:1,pagecount:1,totalCount:0,pagesize:10},filename:"",stacks:"",mapList:[],maps:"",currentStatus:"",statusList:[],showTask:!1}},methods:{changeTab:function(t){"js"==t?(this.isJs=!0,this.boxwidth="96vw",this.boxheight="96vh"):(this.isJs=!1,this.getMapList(),this.boxwidth="60vw",this.boxheight="96vh")},printstack:function(){var t=this;if(0!=this.state)return this.$wool.showwarn("该实例不在运行中,不能thread dump");this.showTask=!0;var s={id:this.id};this.$wf.post("devops?method=/devops/home/print_stack",s).then((function(s){var e=setInterval((function(){t.$wf.post("devops?method=/devops/home/optask",{id:s}).then((function(s){t.currentStatus=s.current_status.desc,t.statusList=s.status,s.done&&(clearInterval(e),setTimeout((function(){t.showTask&&(t.showTask=!1,t.statusList=[],t.getStack())}),5e3))})).catch((function(s){clearInterval(e),t.$wool.showwarn(s)}))}),1e3)})).catch((function(s){t.$wool.showwarn(s)}))},checkstack:function(t){var s=this,e=this.$wool.showloading("正在加载"),a={id:this.id,name:t};this.$wf.post("devops?method=/devops/home/stack",a).then((function(a){e.hide(),s.filename=t,s.stacks=a})).catch((function(t){s.$wool.showwarn(t)}))},getStack:function(){var t=this,s={page:this.page.current,page_size:this.page.pagesize,id:this.id},e=this.$wool.showloading("正在加载");this.$wf.post("devops?method=/devops/home/stacks",s).then((function(s){if(e.hide(),console.log(s),0==s.items.length)t.page.totalCount=0,t.page.pagecount=1,t.$wool.showwarn("暂无数据");else{t.stackList=s.items,t.page.totalCount=s.count,t.page.pagecount=s.page_count;for(var a=0;a<s.items.length;a++){var o=new Date(t.stackList[a].create_time),i=o.getFullYear(),n=o.getMonth()+1;n=n<10?"0"+n:n;var c=o.getDate();c=c<10?"0"+c:c;var h=o.getHours();h=h<10?"0"+h:h;var r=o.getMinutes();r=r<10?"0"+r:r;var l=o.getSeconds();l=l<10?"0"+l:l,t.stackList[a].create_time=i+"-"+n+"-"+c+" "+h+":"+r+":"+l}}})).catch((function(s){e.hide(),t.$wool.showwarn(s)}))},getMapList:function(){var t=this,s=this.$wool.showloading("正在加载");this.$wf.post("devops?method=/devops/home/memory_maps",{id:this.id}).then((function(e){if(s.hide(0),0==e.items.length)t.$wool.showwarn("暂无数据");else{t.mapList=e.items,t.pagemap.totalCount=e.count,t.pagemap.pagecount=e.page_count;for(var a=0;a<e.items.length;a++){console.log(t.mapList[a].create_time);var o=new Date(t.mapList[a].create_time),i=o.getFullYear(),n=o.getMonth()+1;n=n<10?"0"+n:n;var c=o.getDate();c=c<10?"0"+c:c;var h=o.getHours();h=h<10?"0"+h:h;var r=o.getMinutes();r=r<10?"0"+r:r;var l=o.getSeconds();l=l<10?"0"+l:l,t.mapList[a].create_time=i+"-"+n+"-"+c+" "+h+":"+r+":"+l,console.log(t.mapList[a].create_time)}}console.log(e)})).catch((function(e){s.hide(),t.$wool.showwarn(e)}))},closeShowModel:function(){Object.assign(this.$data,this.$options.data()),this.$emit("tapCloser",this.index)},searchByPage:function(t){this.isJs?(this.page.current=t.page,this.getStack()):(this.pagemap.current=t.page,this.getMapList())},printmap:function(){var t=this;if(0!=this.state)return this.$wool.showwarn("该实例不在运行中,不能heap dump");this.showTask=!0;var s=this.$wool.showloading("正在加载"),e={id:this.id};this.$wf.post("devops?method=/devops/home/print_memorymap",e).then((function(e){s.hide(0);var a=setInterval((function(){t.$wf.post("devops?method=/devops/home/optask",{id:e}).then((function(s){t.currentStatus=s.current_status.desc,t.statusList=s.status,s.done&&(clearInterval(a),setTimeout((function(){t.showTask&&(t.showTask=!1,t.statusList=[],t.getMapList())}),5e3))})).catch((function(s){clearInterval(a),t.$wool.showwarn(s)}))}),1e3)})).catch((function(e){s.hide(0),t.$wool.showwarn(e)}))},download:function(t){var s=this,e={id:this.id,name:t};this.$wf.post("devops?method=/devops/home/down_stack",e).then((function(t){window.open(t.wf_resp.res_url)})).catch((function(t){s.$wool.showwarn(t)}))},downloadMap:function(t){var s=this,e={id:this.id,name:t};this.$wf.post("devops?method=/devops/home/downMemoryMap",e).then((function(t){window.open(t.wf_resp.res_url)})).catch((function(t){s.$wool.showwarn(t)}))},replace:function(t){if(null!=t&&0!=t.length)return t.replace(/\n/g,"<br />")},closeShowTask:function(){this.showTask=!1,this.statusList=[],this.isJs?this.getStack():this.getMapList()}}}),n=i,c=(e("9be4"),e("2877")),h=Object(c["a"])(n,a,o,!1,null,"6d2f413c",null);s["default"]=h.exports},a987:function(t,s,e){}}]);