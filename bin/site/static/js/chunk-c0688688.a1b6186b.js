(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c0688688"],{5732:function(e,t,i){e.exports=i.p+"static/img/dele.f5a9b51f.png"},"8d27":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("WoolShowmodal",{attrs:{isshow:e.isshow,isshowcloser:!0},on:{tapCloser:function(t){return e.$emit("toggle")}}},[s("div",{staticClass:"addRunning "},[s("div",{staticClass:"titlebar flexlayout"},["add"==e.operate?s("span",[e._v("添加实例")]):e._e(),"update"==e.operate?s("span",[e._v("修改实例")]):e._e(),"detail"==e.operate?s("span",[e._v("查看实例")]):e._e()]),s("div",{staticClass:"editcontent wt-scroll"},[s("div",{staticClass:"input-box flexlayout"},[s("div",{staticClass:"input-box-title"},[e._v("项目：")]),s("SingleSelect",{attrs:{disabled:"detail"==e.operate,selectname:e.selectProject.name,width:300,items:e.projectList,isdesc:!0},model:{value:e.selectProject.id,callback:function(t){e.$set(e.selectProject,"id",t)},expression:"selectProject.id"}}),s("div",{staticClass:"input-box-title",staticStyle:{"margin-left":"200px"}},[e._v("容器：")]),s("SingleSelect",{attrs:{disabled:"detail"==e.operate,selectname:e.selectMachine.name,items:e.machineList},model:{value:e.selectMachine.id,callback:function(t){e.$set(e.selectMachine,"id",t)},expression:"selectMachine.id"}})],1),"detail"!=e.operate?s("div",{staticClass:"input-box",staticStyle:{display:"flex"}},[s("label",{staticClass:"input-box-title"},[e._v("添加属性：")]),s("TextAnalysis",{staticClass:"luru",on:{confirm:e.getInputProps}})],1):e._e(),s("table",{staticClass:"tableDatil table"},[s("thead",[s("th",{attrs:{width:"30px"}},[e._v("项数")]),s("th",[e._v("属性名")]),s("th",[e._v("属性值")]),s("th",[e._v("范围")]),s("th",{attrs:{width:"30px"}},[e._v("删除")])]),s("tbody",e._l(e.editObj.props,(function(t,o){return s("tr",{key:o,ref:"propstr",refInFor:!0},[s("td",[e._v(e._s(o+1))]),s("td",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"item.key"}],staticClass:"paramtext",staticStyle:{width:"230px"},attrs:{readonly:"detail"==e.operate,type:"text"},domProps:{value:t.key},on:{input:function(i){i.target.composing||e.$set(t,"key",i.target.value)}}})]),s("td",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"item.value"}],staticClass:"paramtext",attrs:{readonly:"detail"==e.operate,type:"text"},domProps:{value:t.value},on:{input:function(i){i.target.composing||e.$set(t,"value",i.target.value)}}})]),s("td",[s("select",{directives:[{name:"model",rawName:"v-model",value:t.scope,expression:"item.scope"}],staticClass:"prop-scope",attrs:{disabled:"detail"==e.operate},on:{change:function(i){var s=Array.prototype.filter.call(i.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"scope",i.target.multiple?s:s[0])}}},e._l(e.propsScopes,(function(t,i){return s("option",{key:i,domProps:{value:t.value}},[e._v(e._s(t.name))])})),0)]),s("td",{staticClass:"table-handle",staticStyle:{"align-content":"center"}},["detail"!=e.operate?s("img",{staticClass:"removeparam",attrs:{src:i("5732")},on:{click:function(t){return e.removeprops(o)}}}):e._e()])])})),0)]),"detail"!=e.operate?s("div",{staticClass:"addrowBar",on:{click:function(t){return e.addRowCount("bind")}}},[e._v("+")]):e._e(),"detail"!=e.operate?s("div",{staticClass:"btn-box"},[s("button",{staticClass:"add-btn",on:{click:e.addRunning}},["add"==e.operate?s("span",[e._v("添  加")]):e._e(),"update"==e.operate?s("span",[e._v("修  改")]):e._e()])]):e._e(),e.editObj.can_delete&&"update"==e.operate?s("div",{staticClass:"delete-btn"},[s("div",{staticClass:"query_button",on:{click:function(t){e.showModal=!0}}},[e._v("\n            删 除 实 例\n          ")])]):e._e()])]),s("ReminderModel",{attrs:{isshow:e.showModal,handelName:"删除",isDelete:!0,deleteName:e.selectProject.name},on:{sure:e.deleteRunning,toggle:function(t){e.showModal=!1}}})],1)},o=[],n=(i("ac6a"),{name:"AddRunning",props:{isshow:{type:Boolean,default:!1},obj:{type:Object,default:function(){return{}}}},components:{WoolShowmodal:function(){return i.e("chunk-41c82f40").then(i.bind(null,"59c5"))},TextAnalysis:function(){return i.e("chunk-1f96a93a").then(i.bind(null,"57c2"))},SingleSelect:function(){return i.e("chunk-9a84efc2").then(i.bind(null,"4e15"))},ReminderModel:function(){return i.e("chunk-1b976ab2").then(i.bind(null,"2578"))}},data:function(){return{msgView:null,operate:"add",propsScopes:[{name:"项目",value:1},{name:"实例",value:0}],projectList:[],selectProject:{},machineList:[],selectMachine:"",editObj:{},showModal:!1}},methods:{removeprops:function(e){this.editObj.props.splice(e,1),this.$forceUpdate()},clearAll:function(){this.operate="add",this.selectProject={},this.selectMachine={},this.editObj={}},addRowCount:function(){this.editObj.props||(this.editObj.props=[]);var e={key:"",value:"",scope:1};this.editObj.props.push(e),this.$forceUpdate()},getInputProps:function(e){var t=this,i=this.$wool.showloading("正在录入..");setTimeout((function(){e.forEach((function(e,i){var s=e.indexOf("="),o={key:e.substring(0,s),value:e.substring(s+1,e.length),scope:1};t.editObj.props||(t.editObj.props=[]),t.editObj.props.push(o),t.$forceUpdate()})),i.hide(0)}),1e3)},getProps:function(){return this.editObj.props},addRunning:function(){var e=this;if("add"==this.operate){if(""==this.selectProject.id)return void this.$wool.showwarn("请选择项目");if(""==this.selectMachine.id)return void this.$wool.showwarn("请选择机器")}var t={op:this.operate,m:this.selectMachine.id,p:this.selectProject.id,props:this.getProps()};"update"==this.operate&&(t.id=this.editObj.id);var i="保存中";this.msgView=this.$wool.showloading(i);var s="?method=/devops/home/running";this.$wf.post(s,t).then((function(t){return e.requestSuc(t)})).catch((function(t){return e.msgView.msgwarn(t.message).hide()}))},deleteRunning:function(){var e=this;this.showModal=!1;var t=this.$wool.showloading("正在删除"),i={id:this.editObj.id,op:"delete"};this.$wf.post("devops?method=/devops/home/running",i).then((function(i){e.$emit("toggle"),e.$emit("load"),t.msgwarn("删除成功！").hide()})).catch((function(e){t.msgwarn(e.message).hide()}))},requestSuc:function(e){e.id&&(this.msgView.msgsucc("保存成功").hide(),this.$emit("toggle"),this.$emit("load"))},getProjectlist:function(){var e=this;this.$wf.post("?method=/devops/home/projects",{page:1,page_size:512,keywords:""}).then((function(t){e.projectList=t.items,e.selectProject.id||e.getMachines()})).catch((function(t){return e.$wool.showwarn("获取项目列表失败"+t.message)}))},getMachines:function(){var e=this;this.$wf.post("?method=/devops/home/machines",{page:1,page_size:512,keywords:"",project:this.selectProject.id}).then((function(t){e.machineList=t.items})).catch((function(t){return e.$wool.showwarn("获取机器列表失败"+t.message)}))},judgeTable:function(){console.log(this.obj),console.log(this.obj=={})}},watch:{"selectProject.id":function(e){this.getMachines()},obj:function(e){var t=this;this.clearAll(),"{}"!=JSON.stringify(e)&&(this.editObj=e,this.operate="update",this.selectProject=e.p,this.selectMachine=e.m,this.editObj.notEdit&&(this.operate="detail"),e.props.forEach((function(e){e.value||t.$set(e,"value","")})))}},mounted:function(){this.getProjectlist(),this.judgeTable()}}),a=n,c=(i("e5c0"),i("2877")),l=Object(c["a"])(a,s,o,!1,null,"c73cb05c",null);t["default"]=l.exports},c596:function(e,t,i){},e5c0:function(e,t,i){"use strict";i("c596")}}]);