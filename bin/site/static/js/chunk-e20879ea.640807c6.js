(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e20879ea"],{"576e":function(t,e,i){"use strict";i("78f5")},"78f5":function(t,e,i){},ff52:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("WoolShowmodal",{attrs:{isshow:t.isshow,isshowcloser:!0},on:{tapCloser:function(e){return t.$emit("toggle")}}},[i("div",{staticClass:"AddMachine wt-scroll"},[i("div",{staticClass:"titlebar flexlayout"},["add"==t.operate?i("span",[t._v("添加容器")]):t._e(),"update"==t.operate?i("span",[t._v("修改容器")]):t._e()]),i("div",{staticClass:"content"},[i("label",{staticClass:"flexlayout input-item",staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"item_name"},[t._v("容器名称：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.machineName,expression:"machineName"}],ref:"mName",staticClass:"item_text",attrs:{placeholder:"请输入机器名称"},domProps:{value:t.machineName},on:{input:function(e){e.target.composing||(t.machineName=e.target.value)}}})]),"add"==t.operate?i("div",{staticClass:"input-item flexlayout"},[i("div",{staticClass:"item_name"},[t._v("容器类型：")]),i("label",{staticClass:"radio-item"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.mtype,expression:"mtype"}],attrs:{type:"radio",name:"type",value:"docker"},domProps:{checked:t._q(t.mtype,"docker")},on:{change:function(e){t.mtype="docker"}}}),t._v("\n              docker\n            ")]),i("label",{staticClass:"radio-item"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.mtype,expression:"mtype"}],attrs:{type:"radio",name:"type",value:"proxy"},domProps:{checked:t._q(t.mtype,"proxy")},on:{change:function(e){t.mtype="proxy"}}}),t._v("\n              proxy\n            ")])]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"update"==t.operate,expression:"operate == 'update'"}],staticClass:"input-item flexlayout input-box-bottom"},[i("div",{staticClass:"input-box-title"},[t._v("所有者：")]),i("SingleSelect",{attrs:{selectname:t.owner.name,items:t.userList},on:{serachbykeyword:t.getUserList},model:{value:t.owner.id,callback:function(e){t.$set(t.owner,"id",e)},expression:"owner.id"}})],1),i("div",{class:["input-item","flexlayout",0!=t.groupList.length||"input-box-bottom"]},[i("div",{staticClass:"input-box-title"},[t._v("运维组：")]),i("MoreSelect",{attrs:{items:t.groupitems,selectname:t.selectGroupNames},on:{select:t.selectdGroupName},model:{value:t.groupids,callback:function(e){t.groupids=e},expression:"groupids"}})],1),0!=t.groupList.length?i("div",{staticClass:"choosed_group"},[i("div",{staticClass:"choosed_group_title"},t._l(t.groupList,(function(e,s){return i("span",{key:s,on:{click:function(e){return t.handleRights(s)}}},[t._v("\n              "+t._s(e.name)+"\n            ")])})),0),i("div",{staticClass:"choosed_group_rights"},[i("p",[t._v(t._s(t.groupList[t.currentIndex].name)+"的权限")]),i("div",{staticClass:"choosed_group_right"},[i("label",{staticClass:"right",attrs:{title:"查看相关信息"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.groupList[t.currentIndex].rights[0],expression:"groupList[currentIndex].rights[0]"}],attrs:{type:"radio",disabled:"detail"==t.operate,name:"read",value:"READ"},domProps:{checked:t._q(t.groupList[t.currentIndex].rights[0],"READ")},on:{change:function(e){return t.$set(t.groupList[t.currentIndex].rights,0,"READ")}}}),i("span",[t._v(" 仅可见")])]),i("label",{staticClass:"right",attrs:{title:"“仅可见”基础上，增加添加、删除实例操作"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.groupList[t.currentIndex].rights[0],expression:"groupList[currentIndex].rights[0]"}],attrs:{type:"radio",disabled:"detail"==t.operate,name:"operator",value:"OPERATOR"},domProps:{checked:t._q(t.groupList[t.currentIndex].rights[0],"OPERATOR")},on:{change:function(e){return t.$set(t.groupList[t.currentIndex].rights,0,"OPERATOR")}}}),i("span",[t._v(" 基础操作")])]),i("label",{staticClass:"right",attrs:{title:"所有管理操作权限"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.groupList[t.currentIndex].rights[0],expression:"groupList[currentIndex].rights[0]"}],attrs:{type:"radio",disabled:"detail"==t.operate,name:"update",value:"UPDATE"},domProps:{checked:t._q(t.groupList[t.currentIndex].rights[0],"UPDATE")},on:{change:function(e){return t.$set(t.groupList[t.currentIndex].rights,0,"UPDATE")}}}),i("span",[t._v(" 管理操作")])])])])]):t._e(),"proxy"==t.mtype?i("div",[i("label",{staticClass:"flexlayout input-item"},[i("div",{staticClass:"item_name"},[t._v("根目录：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.rootName,expression:"rootName"}],ref:"input",staticClass:"item_text",attrs:{placeholder:"请输入机器根目录"},domProps:{value:t.rootName},on:{input:function(e){e.target.composing||(t.rootName=e.target.value)}}})])]):t._e(),i("div",[i("label",{staticClass:"flexlayout input-item"},[i("div",{staticClass:"item_name"},[t._v("链接：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.machineUrl,expression:"machineUrl"}],ref:"input",staticClass:"item_text",attrs:{placeholder:"请输入机器链接"},domProps:{value:t.machineUrl},on:{input:function(e){e.target.composing||(t.machineUrl=e.target.value)}}})])]),i("div",{staticClass:"input-box"},[i("label",[t._v("机器映射")])]),t.editObj.binds&&t.editObj.binds.length>0?i("table",{staticClass:"table tableDatil"},[i("thead",[i("th",[t._v("源目录")]),i("th",[t._v("挂载目录")]),i("th",{attrs:{width:"30px"}},[t._v("删除")])]),i("tbody",t._l(t.editObj.binds,(function(e,s){return i("tr",{key:s,ref:"bindstr",refInFor:!0},[i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.source,expression:"item.source"}],staticClass:"paramtext",staticStyle:{width:"200px"},domProps:{value:e.source},on:{input:function(i){i.target.composing||t.$set(e,"source",i.target.value)}}})]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.target,expression:"item.target"}],staticClass:"paramtext",domProps:{value:e.target},on:{input:function(i){i.target.composing||t.$set(e,"target",i.target.value)}}})]),i("td",{staticClass:"table-handle",on:{click:function(e){return t.removebinds(s)}}},[t._v("移除")])])})),0)]):t._e(),i("div",{staticClass:"addrowBar",on:{click:function(e){return t.addRowCount("bind")}}},[t._v("+")]),i("div",{staticClass:"input-box"},[i("label",[t._v("环境变量")])]),t.editObj.envs&&t.editObj.envs.length>0?i("table",{staticClass:"table tableDatil"},[i("thead",[i("th",[t._v("属性名")]),i("th",[t._v("属性值")]),i("th",{attrs:{width:"30px"}},[t._v("操作")])]),i("tbody",t._l(t.editObj.envs,(function(e,s){return i("tr",{key:s,ref:"envstr",refInFor:!0},[i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.key,expression:"item.key"}],staticClass:"paramtext",staticStyle:{width:"200px"},domProps:{value:e.key},on:{input:function(i){i.target.composing||t.$set(e,"key",i.target.value)}}})]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"item.value"}],staticClass:"paramtext",domProps:{value:e.value},on:{input:function(i){i.target.composing||t.$set(e,"value",i.target.value)}}})]),i("td",{staticClass:"table-handle",on:{click:function(e){return t.removeenvs(t.n)}}},[t._v("移除")])])})),0)]):t._e(),i("div",{staticClass:"addrowBar",on:{click:function(e){return t.addRowCount("envs")}}},[t._v("+")]),i("div",{staticClass:"input-box"},[i("label",[t._v("项目映射示例")])]),i("table",{staticClass:"table tableDatil"},[i("thead",[i("th",[t._v("属性名")]),i("th",[t._v("属性示例值")]),i("th",[t._v("说明")])]),i("tbody",[i("tr",[i("td",[t._v("/data/")]),i("td",[t._v("/data/")]),i("td",[t._v("将宿主机的/data/目录挂载到容器相关项目的/data/目录")])])])]),i("div",{staticClass:"input-box"},[i("label",[t._v("环境变量示例")])]),i("table",{staticClass:"table tableDatil"},[i("thead",[i("th",[t._v("属性名")]),i("th",[t._v("属性示例值")]),i("th",[t._v("说明")])]),i("tbody",[i("tr",[i("td",[t._v("SERVER_ID")]),i("td",[t._v("x0001")]),i("td",[t._v("容器相关项目的服务器id")])]),i("tr",[i("td",[t._v("RLOG_URL")]),i("td",[t._v("http://127.0.0.1:1200/log.j")]),i("td",[t._v("远程日志的链接")])])])]),i("div",{staticClass:"btn-box"},[i("button",{staticClass:"add-btn",on:{click:t.AddMachine}},["add"==t.operate?i("span",[t._v("添加")]):t._e(),"update"==t.operate?i("span",[t._v("修改")]):t._e()])]),t.editObj.can_delete&&"update"==t.operate?i("div",{staticClass:"delete-btn"},[i("div",{staticClass:"query_button",on:{click:function(e){t.showModal=!0}}},[i("span",[t._v("删 除 容 器")])])]):t._e()])]),i("ReminderModel",{attrs:{isshow:t.showModal,handelName:"删除",isDelete:!0,deleteName:t.machineName},on:{sure:t.deleteMachine,toggle:function(e){t.showModal=!1}}})],1)},a=[];i("ac4d"),i("8a81"),i("5df3"),i("1c4c"),i("6b54");function n(t){if(Array.isArray(t))return t}var r=i("db90"),o=i("06c5");function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t){return n(t)||Object(r["a"])(t)||Object(o["a"])(t)||d()}i("28a5"),i("7f7f"),i("ac6a");function u(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=c(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var s=0,a=function(){};return{s:a,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,n=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw n}}}}function c(t,e){if(t){if("string"===typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var h={name:"AddMachine",props:{isshow:{type:Boolean,default:!1},obj:{type:Object,default:function(){return{}}}},components:{WoolShowmodal:function(){return i.e("chunk-41c82f40").then(i.bind(null,"59c5"))},SingleSelect:function(){return i.e("chunk-9a84efc2").then(i.bind(null,"4e15"))},MoreSelect:function(){return i.e("chunk-67c0ae74").then(i.bind(null,"b310"))},ReminderModel:function(){return i.e("chunk-1b976ab2").then(i.bind(null,"2578"))}},data:function(){return{editObj:{},machineName:"",bindsCount:1,envsCount:1,msgView:null,operate:"add",mId:"",mtype:"proxy",rootName:"",machineUrl:"",owner:{},groupitems:[],groupids:"",selectGroupNames:"",userList:[],groupList:[],currentIndex:0,showModal:!1}},methods:{removebinds:function(t){this.editObj.binds.splice(t,1),this.$forceUpdate()},removeenvs:function(t){this.editObj.envs.splice(t,1),this.$forceUpdate()},addRowCount:function(t){if("envs"==t){this.editObj.envs||(this.editObj.envs=[]);var e={key:"",value:""};this.editObj.envs.push(e)}if("bind"==t){this.editObj.binds||(this.editObj.binds=[]);var i={source:"",target:""};this.editObj.binds.push(i)}this.$forceUpdate()},AddMachine:function(){var t=this;if(""==this.machineName)return this.$refs.mName.focus(),void this.$wool.showwarn("请输入机器名");var e=[],i=[];this.editObj.envs||(this.editObj.envs=[]),this.editObj.binds||(this.editObj.binds=[]),this.editObj.envs.forEach((function(t){if(!t.key||!t.value)return!1;e.push(t.key+"="+t.value)})),this.editObj.binds.forEach((function(t){if(!t.source||!t.target)return!1;i.push(t.source+":"+t.target)}));for(var s=0;s<this.groupList.length;s++)if(0==this.groupList[s].rights.length)return void this.$wool.showwarn(this.groupList[s].name+"的权限不能为空！");var a={id:this.mId,op:this.operate,name:this.machineName,envs:e,binds:i,type:this.mtype,url:this.machineUrl,groups:this.groupids.split(";").filter((function(t){return t})),group_list:this.groupList.filter((function(t){return{id:t.id,rights:t.rights}}))};"proxy"==this.mtype&&(a.root=this.rootName),"update"==this.operate&&(a["owner"]=this.owner.id),this.msgView=this.$wool.showloading("保存中");var n="?method=/devops/home/machine";this.$wf.post(n,a).then((function(e){return t.requestSuc(e)})).catch((function(e){t.msgView.msgwarn(e.message).hide()}))},deleteMachine:function(){var t=this;this.showModal=!1;var e=this.$wool.showloading("正在删除"),i={id:this.editObj.id,op:"delete"};this.$wf.post("devops?method=/devops/home/machine",i).then((function(i){t.$emit("toggle"),t.$emit("load"),e.msgwarn("删除成功！").hide()})).catch((function(t){e.msgwarn(t.message).hide()}))},requestSuc:function(t){t.id?(this.msgView.msgsucc("保存成功").hide(),this.$emit("toggle"),this.$emit("load")):this.msgView.msgwarn("保存失败").hide()},clearAll:function(){this.machineName="",this.owner={},this.operate="add",this.rootName="",this.machineUrl="",this.mId="",this.groupids="",this.selectGroupNames="","add"==this.operate&&(this.editObj={}),this.groupList=[],this.currentIndex=0},getGroupList:function(){var t=this;this.$wf.post("?method=/devops/home/groups",{page:1,page_size:100,keywords:""}).then((function(e){t.groupitems=e.items})).catch((function(e){return t.$wool.showwarn("获取群组列表失败"+e.message)}))},getUserList:function(t){var e=this,i={k:t,p:1,pagesize:50},s="?method=/devops/system/users";this.$wf.post(s,i).then((function(t){e.userList=t.items||[]})).catch((function(t){return e.$wool.showwarn(t.message)}))},selectdGroupName:function(t,e){var i=e.split(";");i.pop();var s=t.split(";");s.pop();for(var a=[],n=0;n<s.length;n++)a.push({name:i[n],id:s[n],rights:[]});var r=this;this.groupList=a.map((function(t){return r.groupList.map((function(e){t.id==e.id&&(t.rights=e.rights)})),t})),i=[],s=[],this.currentIndex=0},handleRights:function(t){this.currentIndex=t}},watch:{obj:function(t){var e=this;if(this.clearAll(),"{}"!=JSON.stringify(t)){this.operate="update",this.editObj=t,this.$nextTick((function(){e.owner=t.owner||{},t.groups.forEach((function(t){e.groupids=e.groupids+t.id+";",e.selectGroupNames=e.selectGroupNames+t.name+";",e.groupList.push({id:t.id,name:t.name,rights:t.rights})}))})),this.mId=t.id,this.machineName=t.name;var i=function(t){var e=l(t),i=e[0],s=e.slice(1),a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.toUpperCase()+(a?s.join("").toLowerCase():s.join(""))},s="proxy";this.mId.indexOf(i(s))>-1?this.mtype="proxy":this.mtype="docker";var a,n=u(t.props);try{for(n.s();!(a=n.n()).done;){var r=a.value;"root"==r.key?this.rootName=r.value:("url"==r.key||"url"==r.key)&&(this.machineUrl=r.value)}}catch(o){n.e(o)}finally{n.f()}}}},mounted:function(){this.getGroupList()}},m=h,v=(i("576e"),i("2877")),g=Object(v["a"])(m,s,a,!1,null,"6217622c",null);e["default"]=g.exports}}]);