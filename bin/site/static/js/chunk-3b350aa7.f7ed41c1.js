(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b350aa7"],{"73cf":function(t,e,s){"use strict";s("c079")},"90ad":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADqUlEQVRYR8WXX4gbVRTGv3P3jyhW7UzSIra1mVkWsSj1QcU+iH1QCkppFeqT+lD/0SLoamUzWTBqc1Mt2FYUFNuXPlrqbgutWqG7oIjog0WxYEluFq2wmNzZWgVlu7lHJk4ghN3NnU2weRmSOfd8v/nOPedOCFf5Qzb6N64bXdnfLz4CcAeAdQD+BPArg6dCVXzZJsdiMR0B0kOjdxkjvgJwHUDHmVkRYQUAH8CDYJ7SleLm5UIsCeD4ubXE/EuUnFjcVqvs/blVyPGCPAGvMWN/WJGvLgdiSQDXD06AsZWZdoSVwrFIIOVlh/sFZmdKxWrju597lpk/ZOD1UMl8UoilAbzgMhE+q5XljhXD+dRA/Yok5mcikVbBlJerMvFpXZZP9QxgVSZYXSfMMPilUBUPprzcYQbvjIQJSAPY1XTGzQRfg/CXVvKhngG0J3K94HcCnaypwtPRPdcLSgA+10ruTiraGt+xC5rBrhdwm+2nGPyPVvKxqwLg+tmjMFjbTQs2usuWvt0B1wuOg9khQSViMV5Ve0/b5upJCVwvOAPgbgA3RZPREB7vY3Lm5gY+vXwxH9rCLN+BTDChK3JbvCFnAKyORcsg2qPLhXEbiIQA/E5z9qe83PM1VfggBjhLQryB+XmwEJNxbaPxva+m5KmlQBIBgHB0oWHjesG4VnJ7DHOQjJlgIUYADBvU751Vb/2R+DByhrK3CyNGGLwKhC/AeJcIx6Kp2J4svT7YWJ2W56Lfo3VhqXg+tX70gcgNMmZzbXrfVCKA9Ib89ebvK98AvIGBcwRsbNi6CMBCybsCaF+c8nOvMPP+/x2AgZFQyQP/nYJjj4DMkwuVoOcOxJvpCAj31euDmy5N5y81IDLZrbVK8aRNe3VVgkgg7Y8OGaYvQXREl+WYjWhrTNcADRf84AUw3haib1O19Ob3SSB6AnDDmrwzcM3cj2Cc1Uo+kQTAyWR3EtFh9NMafaHwW6I2bA12vOyLBDoAQdt0qXDCFsLNZA+B6GGt5FDXkzCadABu1tcO3o+f8nM2EG4mO8mgC2FFPtc1QDTpjMAkA4dsXjzd4dwtmOeLIN6uy8WJrgHitvwkumolH+3kQMoP9jBjrG4Gb2228LL3QHOh6wXvAdjSqaYx7BkQjC7LLZ1gE5yGuV0Avw/QbjL184slNtSXJuKPbf8nWAPET/Zt/BbU6cG+00re0ymoccDZBLXGrMwEd/axcRZbVycRzlbkD7Z5EwPYJraN+xd5EM0wc9Z34wAAAABJRU5ErkJggg=="},beac:function(t,e,s){"use strict";s("c714")},c079:function(t,e,s){},c0a2:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("WoolShowmodal",{attrs:{isshow:t.isshow,isshowcloser:!0},on:{tapCloser:function(e){return t.$emit("toggle")}}},[i("div",{staticClass:"trafficTable"},[i("div",[i("div",{staticClass:"titlebar flexlayout"},[i("div",[t._v("\n\t\t\t\t\t\t"+t._s(t.service.name)+" 服务流量表\n\t\t\t\t\t")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("\n\t\t\t\t\t\t\t规则表描述微服务实例的流量规则。\n\t\t\t\t\t\t\t"),i("p",[t._v("\n\t\t\t\t\t\t\t根据微服务实例的编号与版本号，依次按规则项的顺序匹配，无匹配规则时，相当于屏蔽某实例的流量。\n\t\t\t\t\t\t\t")]),t._v("\n\t\t\t\t\t\t\t- 负载均衡："),i("br"),t._v("\n\t\t\t\t\t\t\t  采用加权轮询(WRR)的方式， 初始状态（未配置任何规则）为轮询(RR)。"),i("br"),t._v("\n\t\t\t\t\t\t\t- 熔断保护："),i("br"),t._v("\n\t\t\t\t\t\t\t  1.设置微服务示例的最大并发数。当并发数超过最大值，将不再将请求交给此实例。"),i("br"),t._v("\n\t\t\t\t\t\t\t  2.设置最大连续失败次数与达到次数后的重置时间。当实例的失败次数达到最大值，在重置时间内，将不再将请求交给此实例。"),i("br"),t._v("\n\t\t\t\t\t\t\t  特殊情况，当全部实例的失败次数都达到最大值，将马上重置全部实例。"),i("br"),t._v("\n\t\t\t\t\t\t\t- 请求转发："),i("br"),t._v("\n\t\t\t\t\t\t\t  当网关访问一个微服务实例失败时，默认不会将请求交给其他实例，若要实现类似功能，请参考微服务请求转发。\n\t\t\t\t\t\t")])])]),i("div",{staticClass:"flexlayout flexlayout_middle",staticStyle:{"margin-top":"10px","font-size":"14px"}},[i("span",{staticClass:"warn-note"},[t._v("提示：拖动可调换位置")]),i("p",{staticStyle:{"padding-left":"10px"}},[t._v("是否打开拖动排序模式：")]),i("CheckBox",{attrs:{allowcheck:!0},model:{value:t.isAllowSort,callback:function(e){t.isAllowSort=e},expression:"isAllowSort"}})],1)]),i("div",{staticClass:"trafficInfo"},[i("table",{staticClass:"tableDatil"},[i("thead",[i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("名称")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("无特殊意义，不重复即可")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("服务编号")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("指定使用此规则的微服务实例编号")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("服务版本")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("指定使用此规则的微服务实例版本号")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("权重")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("有效值-100，0-100。-100表示为备用，0表示不可达（屏蔽实例），其他数表示在总流量中的占比；默认为1")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("最大"),i("br"),t._v("并发数")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("实例允许的最大并发请求数，0表示不限；默认为0")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("最大连续"),i("br"),t._v("失败次数")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("允许实例连续失败（网关无法与实例正常通信）的次数，默认为3")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("重置失败"),i("br"),t._v("次数的时间（秒）")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("实例连续失败次数累计到最大值后，超过多少时间后重置失败次数；默认为180秒")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("连接超时值（秒）")]),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("网关连接实例的超时时间；默认为5秒")])])])]),i("th",[i("div",{staticClass:"flex"},[t._v("\n\t\t\t\t\t\t\t\t读超时（秒）\n\t\t\t\t\t\t\t\t"),i("div",{staticClass:"explain-box"},[i("div",{staticClass:"explain-icon"}),i("div",{staticClass:"explain-context"},[t._v("网关等待实例响应的超时时间；默认为50秒")])])])]),i("th",[i("div",{staticClass:"flex"},[i("div",[t._v("操作")])])]),i("th",{directives:[{name:"show",rawName:"v-show",value:t.isAllowSort,expression:"isAllowSort"}]},[i("div",{staticClass:"flex"},[t._v("排序")])])]),i("WoolSortable",{attrs:{tag:"tbody",handle:".traffic-item-handle"},on:{change:t.sortIndex},model:{value:t.trafficInfoItems,callback:function(e){t.trafficInfoItems=e},expression:"trafficInfoItems"}},t._l(t.trafficInfoItems,(function(e,a){return i("tr",{key:a},[i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"item.name"}],staticClass:"smallTable-input traffic",attrs:{type:"text",disabled:!(t.selectIdx==a)},domProps:{value:e.name},on:{input:function(s){s.target.composing||t.$set(e,"name",s.target.value)}}})]),i("td",{staticClass:"selectArea",on:{click:function(e){return t.changeIndex(a)}}},[i("SingleSelect",{attrs:{selectname:e.service_no||"不指定",disabled:!(t.selectIdx==a),items:t.servicesNoList,width:80,leftSpace:10,neednet:!0},on:{select:t.changeSN,serachbykeyword:t.serachbykeyword1}})],1),i("td",{staticClass:"selectArea",on:{click:function(e){return t.changeIndex(a)}}},[i("SingleSelect",{attrs:{selectname:e.service_version||"不指定",items:t.servicesVersionList,disabled:!(t.selectIdx==a),width:80,leftSpace:10,neednet:!0},on:{select:t.changeSV,serachbykeyword:t.serachbykeyword2}})],1),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.weight,expression:"item.weight"}],staticClass:"smallTable-input traffic",attrs:{type:"number",disabled:!(t.selectIdx==a)},domProps:{value:e.weight},on:{input:function(s){s.target.composing||t.$set(e,"weight",s.target.value)}}})]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.max_concurrent,expression:"item.max_concurrent"}],staticClass:"smallTable-input traffic",attrs:{type:"number",disabled:!(t.selectIdx==a)},domProps:{value:e.max_concurrent},on:{input:function(s){s.target.composing||t.$set(e,"max_concurrent",s.target.value)}}})]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.max_fails,expression:"item.max_fails"}],staticClass:"smallTable-input traffic",attrs:{type:"number",disabled:!(t.selectIdx==a)},domProps:{value:e.max_fails},on:{input:function(s){s.target.composing||t.$set(e,"max_fails",s.target.value)}}})]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fail_timeout,expression:"item.fail_timeout"}],staticClass:"smallTable-input traffic",attrs:{type:"number",disabled:!(t.selectIdx==a)},domProps:{value:e.fail_timeout},on:{input:function(s){s.target.composing||t.$set(e,"fail_timeout",s.target.value)}}})]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.connect_timeout,expression:"item.connect_timeout"}],staticClass:"smallTable-input traffic",attrs:{type:"number",disabled:!(t.selectIdx==a)},domProps:{value:e.connect_timeout},on:{input:function(s){s.target.composing||t.$set(e,"connect_timeout",s.target.value)}}})]),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.read_timeout,expression:"item.read_timeout"}],staticClass:"smallTable-input traffic",attrs:{type:"number",disabled:!(t.selectIdx==a)},domProps:{value:e.read_timeout},on:{input:function(s){s.target.composing||t.$set(e,"read_timeout",s.target.value)}}})]),i("td",[i("div",{staticClass:"table-handle-box"},[e.new?i("span",{staticClass:"smallTable-handle",on:{click:function(s){return t.save(e,a,"append")}}},[t._v("保存")]):t._e(),e.new?i("span",{staticClass:"smallTable-handle",on:{click:function(e){return t.deleteRow(a)}}},[t._v("取消")]):t._e(),e.new?t._e():i("span",{staticClass:"smallTable-handle",on:{click:function(s){return t.showRemoveModel(e,a)}}},[t._v("移除")]),e.new?t._e():i("span",{staticClass:"smallTable-handle"},[t.isshowSave&&t.selectIdx==a?t._e():i("span",{on:{click:function(s){return t.replace(e,a)}}},[t._v("编辑")]),t.isshowSave&&t.selectIdx==a?i("span",{on:{click:function(s){return t.save(e,a,"replace")}}},[t._v("保存")]):t._e()]),t.isshowSave&&t.selectIdx==a&&!e.new?i("span",{on:{click:function(e){return t.cancelSave(a)}}},[t._v("取消")]):t._e()])]),i("td",{directives:[{name:"show",rawName:"v-show",value:t.isAllowSort,expression:"isAllowSort"}],staticClass:"right-item-handle"},[i("img",{staticStyle:{width:"20px","margin-bottom":"-5px"},attrs:{src:s("90ad")}})])])})),0),0==t.trafficInfoItems.length?i("tfoot",[i("tr",[i("td",{staticClass:"table-warnning",attrs:{colspan:"11"}},[t._v("暂无数据")])])]):t._e()],1),i("div",{staticClass:"addrowBar",on:{click:t.addRow}},[t._v("+")])])]),i("DeleteConfirmModel",{attrs:{isshow:t.isShowRemove},on:{toggle:function(e){t.isShowRemove=!1},handle:t.remove}})],1)},a=[],n=(s("7f7f"),s("ac6a"),{name:"TrafficTableInfo",components:{WoolShowmodal:function(){return s.e("chunk-41c82f40").then(s.bind(null,"59c5"))},CheckBox:function(){return s.e("chunk-2965e772").then(s.bind(null,"751e"))},WoolSortable:function(){return s.e("chunk-56ca3884").then(s.bind(null,"8ec4"))},DeleteConfirmModel:function(){return s.e("chunk-8418382e").then(s.bind(null,"7f61"))},SingleSelect:function(){return s.e("chunk-9a84efc2").then(s.bind(null,"4e15"))}},props:{isshow:{type:Boolean},service:{type:Object},selectedNoList:{type:Array,default:[]},selectedVersionList:{type:Array,default:[]}},computed:{},data:function(){return{isAllowSort:!1,trafficTableOp:"append",trafficRuleItem:{},trafficInfoItems:[],selectIdx:-1,isshowSave:!1,selectNo:0,copyTrafficInfoItem:[],isShowRemove:!1,needRemoveObj:null,servicesNoList:[],servicesVersionList:[],currentIndex:-1}},methods:{showRemoveModel:function(t,e){this.needRemoveObj=t,this.needRemoveObj.index=e,this.isShowRemove=!0},sortIndex:function(t){if(this.trafficTableOp="move",this.$set(this.trafficRuleItem,"from",t.oldIndex),this.$set(this.trafficRuleItem,"to",t.newIndex),this.trafficInfoItems[t.oldIndex].new||this.trafficInfoItems[t.newIndex].new)return this.selectIdx=-1,this.trafficInfoItems=JSON.parse(JSON.stringify(this.copyTrafficInfoItem)),void this.$wool.showwarn("存在新的一列未保存，不支持调用排序方法",1e3);var e="移动";this.submitFrom(e)},resetData:function(){this.trafficRuleItem={},this.selectIdx=-1,this.trafficTableOp=""},deleteRow:function(t){this.trafficInfoItems.splice(t,1),this.selectIdx=-1},addRow:function(){var t=this;this.selectIdx=-1;var e=!1;if(this.trafficInfoItems.forEach((function(s,i){console.log(s),s.new&&(e=!0,t.selectIdx=i)})),e)this.$wool.showwarn("已存在新的一列！");else{this.$forceUpdate();var s={weight:1,max_fails:3,fail_timeout:180,max_concurrent:0,connect_timeout:5,read_timeout:50,new:!0,service_no:"",service_version:""};this.trafficInfoItems.push(s),this.selectIdx=this.trafficInfoItems.length-1}},remove:function(){var t=this.needRemoveObj;this.trafficTableOp="remove",this.$set(this.trafficRuleItem,"remove_name",t.name),this.$set(this.trafficRuleItem,"index",t.index);var e="移除";this.isShowRemove=!1,this.submitFrom(e)},replace:function(t,e){this.selectIdx=e,this.trafficRuleItem.replace_name=t.name,this.$set(this.trafficRuleItem,"index",e),this.isshowSave=!0},save:function(t,e,s){this.trafficTableOp=s,this.$set(this.trafficRuleItem,"no",t.service_no),this.$set(this.trafficRuleItem,"version",t.service_version),this.$set(this.trafficRuleItem,"name",t.name),this.$set(this.trafficRuleItem,"weight",t.weight),this.$set(this.trafficRuleItem,"max_fails",t.max_fails),this.$set(this.trafficRuleItem,"fail_timeout",t.fail_timeout),this.$set(this.trafficRuleItem,"connect_timeout",t.connect_timeout),this.$set(this.trafficRuleItem,"max_concurrent",t.max_concurrent),this.$set(this.trafficRuleItem,"read_timeout",t.read_timeout);var i="保存";this.submitFrom(i)},cancelSave:function(t){this.trafficInfoItems[t]=Object.assign({},this.copyTrafficInfoItem[t]),this.selectIdx=-1},submitFrom:function(t){var e=this,s=this.$wool.showloading(t+"中"),i="?method=/devops/gateway/traffic",a={op:this.trafficTableOp,name:this.service.name,item:this.trafficRuleItem};this.$wf.post(i,a).then((function(i){e.requesttrafficList(),e.resetData(),s.msgsucc(t+"成功").hide(),Object.assign(e.$data,e.$options.data())})).catch((function(t){s.msgwarn(t.message).hide()}))},requesttrafficList:function(){var t=this;this.copyTrafficInfoItem=[];var e=this.$wool.showloading("正在获取");this.$wf.post("?method=/devops/gateway/traffic",{name:this.service.name}).then((function(s){e.hide(0),t.trafficInfoItems=s.items||[];for(var i=0;i<t.trafficInfoItems.length;i++)null!=t.trafficInfoItems[i].service_no?t.servicesNoList.push({name:t.trafficInfoItems[i].service_no,id:t.trafficInfoItems[i].service_no}):(t.trafficInfoItems[i].service_no="",t.servicesNoList.push({name:"不指定",id:""}));for(var a=0;a<t.trafficInfoItems.length;a++)null!=t.trafficInfoItems[a].service_version?t.servicesVersionList.push({name:t.trafficInfoItems[a].service_version,id:t.trafficInfoItems[a].service_version}):(t.trafficInfoItems[a].service_version="",t.servicesNoList.push({name:"不指定",id:""}));function n(t){for(var e=[],s={},i=0;i<t.length;i++)s[t[i].id]||(e.push(t[i]),s[t[i].id]=!0);return e}t.servicesNoList.push({name:"不指定",id:""}),t.servicesVersionList.push({name:"不指定",id:""}),t.servicesNoList=n(t.servicesNoList),t.servicesVersionList=n(t.servicesVersionList),t.copyTrafficInfoItem=t.trafficInfoItems.map((function(t){var e=Object.assign({},t);return e})),console.log(t.servicesNoList),console.log(t.servicesVersionList)})).catch((function(s){e.hide(0),t.$wool.showwarn(s.message)}))},changeSN:function(t){this.trafficInfoItems[this.currentIndex].service_no=t},changeSV:function(t){this.trafficInfoItems[this.currentIndex].service_version=t},changeIndex:function(t){this.currentIndex=t},serachbykeyword1:function(t){this.currentIndex>-1&&(this.trafficInfoItems[this.currentIndex].service_no=t)},serachbykeyword2:function(t){this.currentIndex>-1&&(this.trafficInfoItems[this.currentIndex].service_version=t)}},watch:{isshow:function(t){t?(this.servicesNoList=this.selectedNoList,this.servicesVersionList=this.selectedVersionList,this.requesttrafficList()):(this.servicesNoList=[],this.servicesVersionList=[])}}}),c=n,o=(s("73cf"),s("beac"),s("2877")),l=Object(o["a"])(c,i,a,!1,null,"e8be653c",null);e["default"]=l.exports},c714:function(t,e,s){}}]);